import{_ as n,c as s,a,o as i}from"./app-CC5quYyA.js";const t={};function l(o,e){return i(),s("div",null,e[0]||(e[0]=[a(`<h1 id="mq-deserialization-unauthorized-class-exception" tabindex="-1"><a class="header-anchor" href="#mq-deserialization-unauthorized-class-exception"><span>MQ deserialization unauthorized class exception</span></a></h1><p>Spring AMQP deserialization unauthorized class exception solution</p><h2 id="problem-description" tabindex="-1"><a class="header-anchor" href="#problem-description"><span>Problem Description:</span></a></h2><p>In October 2023, Spring officially disclosed the CVE-2023-34050 Spring AMQP deserialization vulnerability. Since SimpleMessageConverter or SerializerMessageConverter does not have a whitelist configured by default, any class can be deserialized. In the new version, deserialization of any class is not allowed without a whitelist configured.<br> After fixing the vulnerability, you need to use the allowed serialization class when using <code>SimpleMessageConverter</code>or . Otherwise, an exception is thrown:<code>SerializerMessageConverter\`\`addAllowedListPatterns\`\`java.lang.SecurityException</code></p><h2 id="solution" tabindex="-1"><a class="header-anchor" href="#solution"><span>solution</span></a></h2><p>Method 1: Set <strong>the system environment variable</strong> : SPRING_AMQP_DESERIALIZATION_TRUST_ALL (trust all message senders)</p><p><strong>IntelliJ IDEA:</strong></p><ol><li>Edit Run Settings</li><li>Click More Options, check Environment Variables, and fill in<code>SPRING_AMQP_DESERIALIZATION_TRUST_ALL=true</code></li></ol><p>Method 2 (recommended): Use <code>Jackson2JsonMessageConverter</code>message conversion classes instead <code>simple</code>.</p><ol><li>Make sure the following dependencies have been imported:</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">&lt;dependency&gt;</span>
<span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span>
<span class="line">    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span>
<span class="line">&lt;/dependency&gt;</span>
<span class="line">&lt;dependency&gt;</span>
<span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span>
<span class="line">    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span>
<span class="line">&lt;/dependency&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>copy</p><ol start="2"><li>Custom message converter, injected into the container:</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">@Configuration</span>
<span class="line">public class RabbitMqConfig {</span>
<span class="line">    //....</span>
<span class="line">    @Bean</span>
<span class="line">    public MessageConverter messageConverter(){</span>
<span class="line">        return new Jackson2JsonMessageConverter();</span>
<span class="line">    }</span>
<span class="line">    //....</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>copy</p>`,15)]))}const d=n(t,[["render",l]]),c=JSON.parse('{"path":"/syncboot/upgrade/mq-deserialization-unauthorized-class-exception.html","title":"MQ deserialization unauthorized class exception","lang":"ko-KR","frontmatter":{"order":6},"git":{"updatedTime":1749510202000,"contributors":[{"name":"poh","username":"poh","email":"poh@empasy.com","commits":1,"url":"https://github.com/poh"}],"changelog":[{"hash":"e8d2845a48d72a49b99a62ed0e9511823ff14831","time":1749510202000,"email":"poh@empasy.com","author":"poh","message":"로고 alt text 변경"}]},"filePathRelative":"syncboot/upgrade/mq-deserialization-unauthorized-class-exception.md"}');export{d as comp,c as data};
